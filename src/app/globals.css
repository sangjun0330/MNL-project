@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  color-scheme: light;
  --rnest-bg: #F7F7F8;
  --rnest-text: #1C1C1E;
  --rnest-sub: rgba(28, 28, 30, 0.72);
  --rnest-muted: rgba(28, 28, 30, 0.56);
  --rnest-card: #FFFFFF;
  --rnest-sep: rgba(60, 60, 67, 0.18);
  --rnest-accent: #163B73;
  --rnest-accent-strong: #0F2A54;
  --rnest-accent-soft: rgba(22, 59, 115, 0.12);
  --rnest-accent-border: rgba(22, 59, 115, 0.28);
  --rnest-selection: rgba(22, 59, 115, 0.16);

  /* ── Apple-grade easing functions ── */
  --rnest-ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
  --rnest-ease-soft: cubic-bezier(0.22, 1, 0.36, 1);
  --rnest-ease-apple: cubic-bezier(0.22, 1, 0.36, 1);
  --rnest-ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.1);     /* subtle overshoot */
  --rnest-ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);          /* playful bounce */
  --rnest-ease-decel: cubic-bezier(0, 0, 0.2, 1);                   /* iOS deceleration */
  --rnest-ease-accel: cubic-bezier(0.4, 0, 1, 1);                   /* exit acceleration */

  /* ── Duration tokens ── */
  --rnest-dur-micro: 120ms;   /* tap feedback, icon toggle */
  --rnest-dur-fast: 180ms;    /* quick interactions */
  --rnest-dur-med: 300ms;     /* medium transitions */
  --rnest-dur-slow: 420ms;    /* slower animations */
  --rnest-dur-page: 480ms;    /* page transitions */
  --rnest-dur-sheet: 500ms;   /* bottom sheet slide */
  --rnest-dur-modal: 400ms;   /* modal/dialog animations */
}

html, body {
  height: 100%;
}

body {
  background-color: var(--rnest-bg);
  color: var(--rnest-text);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display",
    "Apple SD Gothic Neo", "Noto Sans KR", "Helvetica Neue", "Segoe UI", Roboto, Helvetica, Arial,
    "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
  letter-spacing: -0.01em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  transition: background-color var(--rnest-dur-page) var(--rnest-ease-smooth),
    color var(--rnest-dur-page) var(--rnest-ease-smooth);
}

/* ✅ iOS-like tap behaviour */
* { -webkit-tap-highlight-color: transparent; }

/* ===================================
   Page Transitions (route changes)
   =================================== */

@keyframes rnestPageEnter {
  from {
    opacity: 0;
    transform: translate3d(0, 16px, 0) scale(0.97);
    filter: blur(4px);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
    filter: blur(0);
  }
}

@keyframes rnestPageExit {
  from {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
    filter: blur(0);
  }
  to {
    opacity: 0;
    transform: translate3d(0, -8px, 0) scale(0.985);
    filter: blur(2px);
  }
}

.rnest-page-enter {
  animation: rnestPageEnter var(--rnest-dur-page) var(--rnest-ease-apple) both;
  will-change: transform, opacity, filter;
}

/* ===================================
   Modal & Backdrop
   =================================== */

@keyframes rnestBackdropIn {
  from { opacity: 0; backdrop-filter: blur(0); }
  to { opacity: 1; backdrop-filter: blur(8px); }
}

@keyframes rnestModalIn {
  from {
    opacity: 0;
    transform: translate3d(0, 18px, 0) scale(0.96);
    filter: blur(6px);
  }
  60% {
    opacity: 1;
    filter: blur(0);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
    filter: blur(0);
  }
}

.rnest-backdrop {
  animation: rnestBackdropIn var(--rnest-dur-modal) var(--rnest-ease-apple) both;
}

.rnest-modal {
  animation: rnestModalIn var(--rnest-dur-modal) var(--rnest-ease-spring) both;
  will-change: transform, opacity, filter;
}

/* ===================================
   Bottom Navigation
   =================================== */

.rnest-nav-bar {
  border-radius: 999px;
  background: #ffffff;
  border: 1px solid rgba(60, 60, 67, 0.12);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
  transition: transform var(--rnest-dur-med) var(--rnest-ease-apple),
    opacity var(--rnest-dur-med) var(--rnest-ease-apple);
}

.rnest-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  min-height: 44px;
  padding: 6px 8px;
  border-radius: 999px;
  transition:
    transform var(--rnest-dur-fast) var(--rnest-ease-spring),
    color var(--rnest-dur-med) var(--rnest-ease-apple),
    background-color var(--rnest-dur-med) var(--rnest-ease-apple);
}

.rnest-nav-item:active {
  transform: scale(0.92);
}

.rnest-nav-icon {
  width: 20px;
  height: 20px;
  transition: transform var(--rnest-dur-fast) var(--rnest-ease-spring);
}

.rnest-nav-active .rnest-nav-icon {
  transform: scale(1.08);
}

.rnest-nav-label {
  font-size: 11px;
  font-weight: 600;
  line-height: 1;
}

.rnest-nav-active {
  background: #F2F2F7;
  color: var(--rnest-accent);
}

.rnest-nav-inactive {
  color: rgba(60, 60, 67, 0.6);
}

/* ===================================
   Billing/Admin UI System
   =================================== */

.rnest-surface {
  border-radius: 28px;
  border: 1px solid var(--rnest-sep);
  background: linear-gradient(180deg, #FFFFFF 0%, #FCFDFF 100%);
  box-shadow: 0 14px 36px rgba(16, 24, 40, 0.06);
}

.rnest-sub-surface {
  border-radius: 18px;
  border: 1px solid var(--rnest-sep);
  background: rgba(255, 255, 255, 0.72);
}

.rnest-chip-accent {
  border-radius: 999px;
  border: 1px solid var(--rnest-accent-border);
  background: var(--rnest-accent-soft);
  color: var(--rnest-accent);
  font-weight: 600;
}

.rnest-chip-muted {
  border-radius: 999px;
  border: 1px solid var(--rnest-sep);
  background: rgba(255, 255, 255, 0.86);
  color: var(--rnest-sub);
  font-weight: 600;
}

.rnest-btn-primary {
  border-radius: 999px;
  border: 1px solid var(--rnest-accent-strong);
  background: linear-gradient(180deg, var(--rnest-accent) 0%, var(--rnest-accent-strong) 100%);
  color: #FFFFFF;
  font-weight: 700;
  transition: transform var(--rnest-dur-fast) var(--rnest-ease-spring),
    opacity var(--rnest-dur-fast) var(--rnest-ease-apple),
    box-shadow var(--rnest-dur-fast) var(--rnest-ease-apple);
  box-shadow: 0 8px 20px rgba(22, 59, 115, 0.26);
}

.rnest-btn-primary:hover {
  opacity: 0.96;
}

.rnest-btn-primary:active {
  transform: scale(0.97);
}

.rnest-btn-secondary {
  border-radius: 999px;
  border: 1px solid var(--rnest-sep);
  background: rgba(255, 255, 255, 0.86);
  color: var(--rnest-text);
  font-weight: 600;
  transition: transform var(--rnest-dur-fast) var(--rnest-ease-spring),
    background-color var(--rnest-dur-fast) var(--rnest-ease-apple),
    border-color var(--rnest-dur-fast) var(--rnest-ease-apple);
}

.rnest-btn-secondary:hover {
  border-color: var(--rnest-accent-border);
  background: rgba(255, 255, 255, 0.96);
}

.rnest-btn-secondary:active {
  transform: scale(0.97);
}

.rnest-link-accent {
  color: var(--rnest-accent);
  text-decoration: none;
  transition: color var(--rnest-dur-fast) var(--rnest-ease-apple),
    text-decoration-color var(--rnest-dur-fast) var(--rnest-ease-apple);
}

.rnest-link-accent:hover {
  color: var(--rnest-accent-strong);
  text-decoration: underline;
  text-underline-offset: 4px;
}

/* ===================================
   Staggered Card / List Animations
   =================================== */

@keyframes rnestCardEnter {
  from {
    opacity: 0;
    transform: translate3d(0, 12px, 0) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }
}

/* Apply to cards in page content — auto-stagger */
.rnest-page-enter > div > div,
.rnest-page-enter > section,
.rnest-page-enter > div > section {
  animation: rnestCardEnter var(--rnest-dur-med) var(--rnest-ease-apple) both;
}

.rnest-page-enter > div > div:nth-child(1),
.rnest-page-enter > section:nth-child(1),
.rnest-page-enter > div > section:nth-child(1) { animation-delay: 60ms; }

.rnest-page-enter > div > div:nth-child(2),
.rnest-page-enter > section:nth-child(2),
.rnest-page-enter > div > section:nth-child(2) { animation-delay: 120ms; }

.rnest-page-enter > div > div:nth-child(3),
.rnest-page-enter > section:nth-child(3),
.rnest-page-enter > div > section:nth-child(3) { animation-delay: 180ms; }

.rnest-page-enter > div > div:nth-child(4),
.rnest-page-enter > section:nth-child(4),
.rnest-page-enter > div > section:nth-child(4) { animation-delay: 240ms; }

.rnest-page-enter > div > div:nth-child(n+5),
.rnest-page-enter > section:nth-child(n+5),
.rnest-page-enter > div > section:nth-child(n+5) { animation-delay: 300ms; }

/* ===================================
   Interactive Press Feedback
   =================================== */

/* Tapable cards/buttons — Apple spring press */
.rnest-pressable {
  transition: transform var(--rnest-dur-micro) var(--rnest-ease-spring),
    box-shadow var(--rnest-dur-fast) var(--rnest-ease-apple);
  will-change: transform;
}
.rnest-pressable:active {
  transform: scale(0.975);
}

/* Links & interactive list items */
a[class*="rounded-apple"],
div[class*="shadow-apple"]:active,
button:not([class*="rnest-nav"]):active {
  transition: transform var(--rnest-dur-micro) var(--rnest-ease-spring);
}

/* ===================================
   Mobile Optimizations
   =================================== */

@keyframes rnestPageEnterMobile {
  from {
    opacity: 0;
    transform: translate3d(0, 12px, 0) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@keyframes rnestModalInMobile {
  from {
    opacity: 0;
    transform: translate3d(0, 14px, 0) scale(0.97);
  }
  60% {
    opacity: 1;
  }
  to {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }
}

@media (hover: none) and (pointer: coarse) {
  .rnest-page-enter {
    animation: rnestPageEnterMobile var(--rnest-dur-page) var(--rnest-ease-apple) both;
  }
  .rnest-modal {
    animation: rnestModalInMobile var(--rnest-dur-modal) var(--rnest-ease-spring) both;
  }
  .rnest-backdrop {
    -webkit-backdrop-filter: blur(4px) saturate(1.1);
    backdrop-filter: blur(4px) saturate(1.1);
  }
}

/* ===================================
   Reduced Motion
   =================================== */

@media (prefers-reduced-motion: reduce) {
  .rnest-page-enter { animation: none; }
  .rnest-backdrop,
  .rnest-modal { animation: none; }
  .rnest-breathe,
  .rnest-wave,
  .rnest-pulse-soft,
  .rnest-float-up { animation: none; }
  .rnest-page-enter > div > div,
  .rnest-page-enter > section,
  .rnest-page-enter > div > section { animation: none; }
  body { transition: none; }
  * { transition-duration: 0ms !important; }
}

::selection {
  background: var(--rnest-selection);
}

/* iOS safe-area helper */
.safe-top { padding-top: env(safe-area-inset-top); }
.safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

/* Subtle scrollbars for desktop */
*::-webkit-scrollbar { height: 8px; width: 8px; }
*::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.14); border-radius: 999px; }
*::-webkit-scrollbar-track { background: transparent; }

/* ===================================
   RNest Insight v2.0 motion
   =================================== */

@keyframes rnestBreathe {
  0%, 100% { transform: scale(0.99); opacity: 0.6; }
  50% { transform: scale(1.01); opacity: 0.95; }
}

@keyframes rnestWave {
  0% { transform: translateX(0); }
  100% { transform: translateX(-160px); }
}

@keyframes rnestPulseSoft {
  0%, 100% { opacity: 0.75; }
  50% { opacity: 1; }
}

@keyframes rnestRecoveryProgress {
  0% { transform: translateX(-40%); opacity: 0.5; }
  50% { opacity: 1; }
  100% { transform: translateX(40%); opacity: 0.5; }
}

@keyframes rnestLogoBreathe {
  0%, 100% { transform: scale(0.98); opacity: 0.55; }
  50% { transform: scale(1.03); opacity: 1; }
}

@keyframes rnestDotPulse {
  0%, 80%, 100% { transform: scale(0.7); opacity: 0.35; }
  40% { transform: scale(1); opacity: 1; }
}

@keyframes rnestFloatUp {
  0% { opacity: 0; transform: translateY(8px); }
  20% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-16px); }
}

/* Shimmer for skeleton loading */
@keyframes rnestShimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.rnest-breathe {
  animation: rnestBreathe 3.6s ease-in-out infinite;
}

.rnest-wave {
  animation: rnestWave 4.4s linear infinite;
}

.rnest-pulse-soft {
  animation: rnestPulseSoft 1.6s ease-in-out infinite;
}

.rnest-recovery-progress {
  animation: rnestRecoveryProgress 1.8s linear infinite;
}

.rnest-logo-breathe {
  animation: rnestLogoBreathe 2.4s ease-in-out infinite;
}

.rnest-dot-pulse {
  animation: rnestDotPulse 1.2s ease-in-out infinite;
}

.rnest-float-up {
  animation: rnestFloatUp 1.2s ease-out forwards;
}

.rnest-shimmer {
  position: relative;
  overflow: hidden;
}
.rnest-shimmer::after {
  content: '';
  position: absolute;
  inset: 0;
  transform: translateX(-100%);
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: rnestShimmer 1.8s var(--rnest-ease-decel) infinite;
}

/* ===================================
   Smooth content transitions
   =================================== */

/* Cards, sections, and list items fade/slide smoothly */
.space-y-4 > * {
  transition: transform var(--rnest-dur-med) var(--rnest-ease-apple),
    opacity var(--rnest-dur-med) var(--rnest-ease-apple);
}

/* Back button hover */
a[aria-label="Back"] {
  transition: transform var(--rnest-dur-fast) var(--rnest-ease-spring),
    background-color var(--rnest-dur-fast) var(--rnest-ease-apple);
}
a[aria-label="Back"]:active {
  transform: scale(0.9);
}

/* Detail page summary cards */
.rounded-apple {
  transition: transform var(--rnest-dur-fast) var(--rnest-ease-spring),
    box-shadow var(--rnest-dur-med) var(--rnest-ease-apple);
}
.rounded-apple:active {
  transform: scale(0.98);
}

.rnest-no-press,
.rnest-no-press:active {
  transform: none !important;
  transition: none !important;
}

/* ===================================
   RNest Night Mode (auto)
   Trigger: night_streak >= 3
   =================================== */

html.rnest-night {
  color-scheme: dark;
  --rnest-bg: #0B1220;
  --rnest-text: rgba(255,255,255,0.92);
  --rnest-sub: rgba(255,255,255,0.64);
  --rnest-muted: rgba(255,255,255,0.52);
  --rnest-card: #111A2E;
  --rnest-sep: rgba(255,255,255,0.12);
  --rnest-accent: #90AFE7;
  --rnest-accent-strong: #7A9BD9;
  --rnest-accent-soft: rgba(144, 175, 231, 0.18);
  --rnest-accent-border: rgba(144, 175, 231, 0.32);
  --rnest-selection: rgba(144, 175, 231, 0.22);
}

html.rnest-night body {
  background-color: var(--rnest-bg);
  color: var(--rnest-text);
}

html.rnest-night *::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.18);
}

/* Tailwind token overrides (best-effort) */
html.rnest-night .bg-ios-bg { background-color: #0B1220 !important; }
html.rnest-night .bg-ios-card { background-color: #111A2E !important; }
html.rnest-night .border-ios-sep { border-color: rgba(255,255,255,0.12) !important; }
html.rnest-night .text-ios-text { color: rgba(255,255,255,0.92) !important; }
html.rnest-night .text-ios-sub { color: rgba(255,255,255,0.62) !important; }
html.rnest-night .text-ios-muted { color: rgba(255,255,255,0.55) !important; }

/* Common utility colors used across the app */
html.rnest-night .bg-white { background-color: #111A2E !important; }
html.rnest-night .bg-white\/90 { background-color: rgba(17,26,46,0.90) !important; }
html.rnest-night .bg-white\/85 { background-color: rgba(17,26,46,0.85) !important; }
html.rnest-night .bg-white\/80 { background-color: rgba(17,26,46,0.80) !important; }
html.rnest-night .bg-white\/70 { background-color: rgba(17,26,46,0.70) !important; }
html.rnest-night .bg-white\/60 { background-color: rgba(17,26,46,0.60) !important; }
html.rnest-night .bg-white\/50 { background-color: rgba(17,26,46,0.50) !important; }

html.rnest-night .text-black { color: rgba(255,255,255,0.92) !important; }
html.rnest-night .text-black\/80 { color: rgba(255,255,255,0.80) !important; }
html.rnest-night .text-black\/70 { color: rgba(255,255,255,0.70) !important; }
html.rnest-night .text-black\/60 { color: rgba(255,255,255,0.60) !important; }
html.rnest-night .text-black\/50 { color: rgba(255,255,255,0.50) !important; }

html.rnest-night .bg-black\/5 { background-color: rgba(255,255,255,0.08) !important; }
html.rnest-night .bg-black\/7 { background-color: rgba(255,255,255,0.10) !important; }
html.rnest-night .bg-black\/10 { background-color: rgba(255,255,255,0.12) !important; }
html.rnest-night .hover\:bg-white:hover { background-color: rgba(255,255,255,0.08) !important; }
html.rnest-night .hover\:bg-white\/85:hover { background-color: rgba(255,255,255,0.10) !important; }

html.rnest-night .focus\:ring-black\/10:focus { --tw-ring-color: rgba(255,255,255,0.18) !important; }

/* BottomNav in night mode */
html.rnest-night .rnest-nav-bar {
  background: #111A2E;
  border-color: rgba(255, 255, 255, 0.12);
  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35);
}

html.rnest-night .rnest-nav-active {
  background: rgba(255, 255, 255, 0.08);
  color: var(--rnest-accent);
}

html.rnest-night .rnest-nav-inactive {
  color: rgba(255, 255, 255, 0.6);
}

html.rnest-night .rnest-surface {
  background: linear-gradient(180deg, #121D34 0%, #10192D 100%);
}

html.rnest-night .rnest-sub-surface {
  background: rgba(17, 26, 46, 0.75);
}

html.rnest-night .rnest-btn-secondary {
  background: rgba(17, 26, 46, 0.92);
}

/* Hardcoded light surfaces -> dark surfaces */
html.rnest-night .bg-\[\#F8F8FB\],
html.rnest-night .bg-\[\#F7F7FA\],
html.rnest-night .bg-\[\#F4F4F6\],
html.rnest-night .bg-\[\#F2F2F7\],
html.rnest-night .bg-\[\#F1F1F1\] {
  background-color: #121d34 !important;
}

html.rnest-night .hover\:bg-\[\#F8F8FB\]:hover,
html.rnest-night .hover\:bg-\[\#F7F7FA\]:hover {
  background-color: rgba(255, 255, 255, 0.08) !important;
}

/* Light info badges/chips */
html.rnest-night .bg-\[\#EDF3FF\],
html.rnest-night .bg-\[\#EEF4FF\],
html.rnest-night .bg-\[\#E4ECFF\],
html.rnest-night .bg-\[\#eef4ff\] {
  background-color: rgba(144, 175, 231, 0.18) !important;
}

html.rnest-night .bg-\[\#FEF9C3\],
html.rnest-night .bg-\[\#FFF6CC\] {
  background-color: rgba(124, 94, 16, 0.22) !important;
}

html.rnest-night .bg-\[\#FFD2DA\] {
  background-color: rgba(179, 38, 30, 0.24) !important;
}

html.rnest-night .bg-\[\#1B27470F\] {
  background-color: rgba(144, 175, 231, 0.14) !important;
}

html.rnest-night .border-\[\#DDE5F3\],
html.rnest-night .border-\[\#D7DEEB\],
html.rnest-night .border-\[\#C7D5F0\],
html.rnest-night .border-\[\#EAB30855\],
html.rnest-night .border-\[\#1B274733\] {
  border-color: rgba(255, 255, 255, 0.18) !important;
}

html.rnest-night .text-\[\#7C5E10\] {
  color: #f8d47a !important;
}

html.rnest-night .text-\[\#5F1322\] {
  color: #ffc2cc !important;
}

html.rnest-night .text-\[\#1B2747\],
html.rnest-night .text-\[\#163B73\] {
  color: rgba(224, 236, 255, 0.92) !important;
}
